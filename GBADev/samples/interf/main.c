#include "mygba.h"

MULTIBOOT

#include "gfx/bars.raw.c"
#include "gfx/bars.map.c"
#include "gfx/bars2.raw.c"
#include "gfx/bars2.map.c"
#include "gfx/logo.raw.c"
#include "gfx/master.pal.c"

u16 wobble[256] = {
  180,  184,  188,  193,  197,  201,  206,  210,
  214,  219,  223,  227,  231,  236,  240,  244,
  248,  252,  256,  260,  264,  268,  272,  275,
  279,  283,  286,  290,  293,  296,  300,  303,
  306,  309,  312,  315,  318,  321,  323,  326,
  328,  331,  333,  335,  338,  340,  342,  343,
  345,  347,  348,  350,  351,  352,  353,  354,
  355,  356,  357,  358,  358,  358,  359,  359,
  359,  359,  359,  359,  358,  358,  357,  357,
  356,  355,  354,  353,  352,  350,  349,  347,
  346,  344,  342,  340,  338,  336,  334,  332,
  329,  327,  324,  322,  319,  316,  313,  310,
  307,  304,  301,  298,  294,  291,  287,  284,
  280,  277,  273,  269,  265,  261,  257,  253,
  249,  245,  241,  237,  233,  229,  225,  220,
  216,  212,  207,  203,  199,  194,  190,  185,
  181,  177,  172,  168,  164,  159,  155,  150,
  146,  142,  138,  133,  129,  125,  121,  117,
  112,  108,  104,  100,  96,  93,  89,  85,
  81,  78,  74,  71,  67,  64,  60,  57,
  54,  51,  48,  45,  42,  39,  37,  34,
  31,  29,  27,  24,  22,  20,  18,  16,
  14,  13,  11,  10,  8,  7,  6,  5,
  4,  3,  2,  2,  1,  1,  0,  0,
  0,  0,  0,  0,  1,  1,  2,  2,
  3,  4,  5,  6,  7,  8,  10,  11,
  13,  14,  16,  18,  20,  22,  24,  26,
  29,  31,  34,  36,  39,  42,  45,  48,
  51,  54,  57,  60,  63,  67,  70,  74,
  77,  81,  85,  89,  92,  96,  100,  104,
  108,  112,  116,  120,  125,  129,  133,  137,
  142,  146,  150,  154,  159,  163,  168,  172
};

s8 wobble2[256] = {

  0,  0,  1,  1,  2,  2,  3,  3,
  4,  4,  5,  5,  6,  6,  7,  7,
  8,  8,  9,  9,  9,  10,  10,  11,
  11,  11,  12,  12,  13,  13,  13,  14,
  14,  14,  15,  15,  15,  16,  16,  16,
  17,  17,  17,  17,  18,  18,  18,  18,
  18,  19,  19,  19,  19,  19,  19,  19,
  20,  20,  20,  20,  20,  20,  20,  20,
  20,  20,  20,  20,  20,  20,  20,  20,
  20,  20,  19,  19,  19,  19,  19,  19,
  19,  18,  18,  18,  18,  17,  17,  17,
  17,  16,  16,  16,  16,  15,  15,  15,
  14,  14,  14,  13,  13,  12,  12,  12,
  11,  11,  10,  10,  10,  9,  9,  8,
  8,  7,  7,  6,  6,  5,  5,  5,
  4,  4,  3,  3,  2,  2,  1,  1,
  0,  0, -1, -1, -2, -2, -3, -3,
 -4, -4, -5, -5, -6, -6, -7, -7,
 -7, -8, -8, -9, -9, -10, -10, -11,
 -11, -11, -12, -12, -13, -13, -13, -14,
 -14, -14, -15, -15, -15, -16, -16, -16,
 -17, -17, -17, -17, -18, -18, -18, -18,
 -18, -19, -19, -19, -19, -19, -19, -19,
 -20, -20, -20, -20, -20, -20, -20, -20,
 -20, -20, -20, -20, -20, -20, -20, -20,
 -20, -20, -19, -19, -19, -19, -19, -19,
 -19, -18, -18, -18, -18, -18, -17, -17,
 -17, -17, -16, -16, -16, -15, -15, -15,
 -14, -14, -14, -13, -13, -13, -12, -12,
 -11, -11, -11, -10, -10, -9, -9, -8,
 -8, -8, -7, -7, -6, -6, -5, -5,
 -4, -4, -3, -3, -2, -2, -1, -1
};

u8 myy[256]={
  50,  52,  53,  54,  55,  57,  58,  59,
  60,  61,  62,  64,  65,  66,  67,  68,
  69,  71,  72,  73,  74,  75,  76,  77,
  78,  79,  80,  81,  82,  83,  84,  85,
  85,  86,  87,  88,  89,  89,  90,  91,
  92,  92,  93,  93,  94,  95,  95,  96,
  96,  97,  97,  97,  98,  98,  98,  99,
  99,  99,  99,  100,  100,  100,  100,  100,
  100,  100,  100,  100,  100,  100,  99,  99,
  99,  99,  99,  98,  98,  98,  97,  97,
  96,  96,  95,  95,  94,  94,  93,  92,
  92,  91,  90,  90,  89,  88,  87,  87,
  86,  85,  84,  83,  82,  81,  80,  79,
  78,  77,  76,  75,  74,  73,  72,  71,
  70,  69,  68,  66,  65,  64,  63,  62,
  61,  59,  58,  57,  56,  55,  53,  52,
  51,  50,  49,  47,  46,  45,  44,  42,
  41,  40,  39,  38,  37,  35,  34,  33,
  32,  31,  30,  29,  28,  27,  25,  24,
  23,  22,  21,  20,  20,  19,  18,  17,
  16,  15,  14,  13,  13,  12,  11,  10,
  10,  9,  8,  8,  7,  7,  6,  5,
  5,  5,  4,  4,  3,  3,  3,  2,
  2,  2,  2,  1,  1,  1,  1,  1,
  1,  1,  1,  1,  1,  1,  1,  2,
  2,  2,  2,  3,  3,  3,  4,  4,
  5,  5,  5,  6,  7,  7,  8,  8,
  9,  10,  10,  11,  12,  13,  13,  14,
  15,  16,  17,  18,  19,  19,  20,  21,
  22,  23,  24,  25,  26,  28,  29,  30,
  31,  32,  33,  34,  35,  37,  38,  39,
  40,  41,  42,  44,  45,  46,  47,  48
};

/*
----------------------------------
 Program entry point
----------------------------------
*/

#define STATE_IDLE 0
#define STATE_MOVE_BG2 1
#define STATE_MOVE_2AND3 2
 
u32 frames=0;
u8 logospr;
u8 logox;
u8 state = STATE_IDLE;

void vbl()
{
	logox++;
	ham_SetObjX(logospr,logox);
	ham_SetObjY(logospr,myy[logox]);

	ham_CopyObjToOAM();
	frames++;
}
void hbl()
{
	//ham_RotBg(2,frames%360,wobble[F_VCNT_CURRENT_SCANLINE]%256,80,0x100);
	ham_RotBg(2,180,wobble[(F_VCNT_CURRENT_SCANLINE+frames)%256]%256,80,COS_SFP32[F_VCNT_CURRENT_SCANLINE%256]);
	//ham_RotBg(3,180,wobble[(F_VCNT_CURRENT_SCANLINE+frames+180)%256]%256,0,SIN_SFP32[F_VCNT_CURRENT_SCANLINE%256]);
	ham_RotBg(3,wobble[frames%256],120,80,0x100-SIN_SFP32[180+(frames%180)]-0x20);
	
}

int main(void)
{
	

    // initialize HAMlib
    ham_Init();

	ham_SetBgMode(2);

	ham_LoadBGPal(&master_Palette,256);
	ham_LoadObjPal(&master_Palette,256);

	ham_bg[2].ti = ham_InitTileSet(&bars_Tiles,SIZEOF_16BIT(bars_Tiles),1,1);
	ham_bg[2].mi = ham_InitMapSet(&bars_Map,1024,1,1);
	ham_bg[3].ti = ham_InitTileSet(&bars2_Tiles,SIZEOF_16BIT(bars2_Tiles),1,1);
	ham_bg[3].mi = ham_InitMapSet(&bars2_Map,1024,1,1);

	ham_InitBg(2,1,1,0);
	ham_InitBg(3,1,0,0);
	logospr = ham_CreateObj((void*)&logo_Tiles[0],1,3,OBJ_MODE_NORMAL,1,0,0,0,0,0,0,150,30);

	M_BG2CNT_WRAP_SET_ON
	M_BG3CNT_WRAP_SET_ON
	R_BLDCNT = (1<<10) | (1<<3) | (1<<6);
    R_BLDALPHA = (5) + (5<<8);
	
	ham_StartIntHandler(INT_TYPE_VBL,&vbl);
	ham_StartIntHandler(INT_TYPE_HBL,&hbl);

    while(1)
    {
    }    
}


